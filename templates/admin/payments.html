{% extends 'admin/base_admin.html' %}
{% block title %}Payments - Admin{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Payment History</h1>
    <a href="{{ url_for('admin.create_payment_link') }}" class="btn btn-primary">Generate Payment Link</a>
</div>

{% if payments %}
<table class="data-table">
    <thead>
        <tr>
            <th>Date</th>
            <th>Customer</th>
            <th>Project</th>
            <th>Amount</th>
            <th>Status</th>
            <th>Payment Method</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        {% for payment in payments %}
        <tr>
            <td>{{ payment.created_at[:10] if payment.created_at else '-' }}</td>
            <td><a href="{{ url_for('admin.customer_detail', customer_id=payment.customer_id) }}">{{ payment.customer_name }}</a></td>
            <td>
                {% if payment.project_id %}
                <a href="{{ url_for('admin.project_detail', project_id=payment.project_id) }}">{{ payment.project_name }}</a>
                {% else %}-{% endif %}
            </td>
            <td>${{ "%.2f"|format(payment.amount) }}</td>
            <td><span class="badge badge-{{ payment.status }}">{{ payment.status|title }}</span></td>
            <td>{{ payment.payment_method|replace('stripe_', '')|title if payment.payment_method else '-' }}</td>
            <td>{{ payment.description or '-' }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<div style="margin-top:2rem; padding:1rem; background:var(--background-color); border-radius:8px;">
    <strong>Total Successful Payments:</strong>
    ${{ "%.2f"|format(payments|selectattr('status', 'equalto', 'succeeded')|sum(attribute='amount')) }}
</div>
{% else %}
<p class="empty-state">No payments yet. <a href="{{ url_for('admin.create_payment_link') }}">Generate a payment link</a> to get started.</p>
{% endif %}
{% endblock %}
