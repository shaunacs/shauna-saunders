{% extends 'customers/base_customers.html' %}

{% block title %}{{ agreement.title }} - Customer Portal{% endblock %}

{% block extra_css %}
<style>
    .breadcrumb {
        color: var(--text-muted, #9ca3af);
    }
    .breadcrumb a {
        color: var(--primary-color, #6366f1);
    }
    .agreement-header {
        background: var(--bg-dark, #1a1a2e);
        border: 1px solid var(--border-color, #2d2d44);
        border-radius: 8px;
        padding: 1.5rem;
        margin-bottom: 2rem;
    }
    .agreement-header h1 {
        margin: 0 0 0.5rem 0;
        color: var(--text-color, #e0e0e0);
    }
    .agreement-meta {
        color: var(--text-muted, #9ca3af);
    }
    .agreement-content {
        background: var(--bg-color, #0f0f1a);
        border: 1px solid var(--border-color, #2d2d44);
        border-radius: 8px;
        padding: 2rem;
        white-space: pre-wrap;
        font-family: Georgia, serif;
        line-height: 1.8;
        margin-bottom: 2rem;
        color: var(--text-color, #e0e0e0);
    }
    .signature-block {
        background: var(--bg-dark, #1a1a2e);
        border: 2px solid #10b981;
        border-radius: 8px;
        padding: 1.5rem;
        margin-top: 2rem;
    }
    .signature-block h3 {
        color: #10b981;
        margin-top: 0;
    }
    .signature-name {
        font-family: 'Brush Script MT', cursive;
        font-size: 2rem;
        color: var(--primary-color, #6366f1);
        padding: 0.5rem 0;
        border-bottom: 1px solid var(--primary-color, #6366f1);
        display: inline-block;
        margin-bottom: 0.5rem;
    }
    .signature-details {
        color: var(--text-muted, #9ca3af);
        font-size: 0.875rem;
    }
    .signature-details strong {
        color: var(--text-color, #e0e0e0);
    }
    .unsigned-notice {
        background: var(--bg-dark, #1a1a2e);
        border: 2px solid #f59e0b;
        border-radius: 8px;
        padding: 1.5rem;
        text-align: center;
        margin-top: 2rem;
    }
    .unsigned-notice h3 {
        color: #fbbf24;
        margin-top: 0;
    }
    .unsigned-notice p {
        color: var(--text-color, #e0e0e0);
    }
    .print-btn {
        float: right;
    }
    .actions {
        display: flex;
        gap: 1rem;
        flex-wrap: wrap;
    }
    .actions .btn-secondary {
        background: var(--bg-color, #0f0f1a);
        border: 1px solid var(--border-color, #2d2d44);
        color: var(--text-color, #e0e0e0);
    }
    .actions .btn-secondary:hover {
        background: var(--bg-darker, #12121f);
        border-color: var(--text-muted, #9ca3af);
    }
    @media print {
        .no-print {
            display: none !important;
        }
        .agreement-content {
            border: none;
            padding: 0;
            background: #fff;
            color: #000;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="breadcrumb no-print">
    <a href="{{ url_for('customers.agreements') }}">Agreements</a>
    <span>/</span>
    <span>{{ agreement.title }}</span>
</div>

<div class="agreement-header">
    <button onclick="window.print()" class="btn btn-secondary print-btn no-print">Print Agreement</button>
    <h1>{{ agreement.title }}</h1>
    <p class="agreement-meta">
        {{ agreement.project_name }} |
        {{ agreement.agreement_type|replace('_', ' ')|title }} |
        Version {{ agreement.version }}
    </p>
</div>

<div class="agreement-content">{{ agreement.content }}</div>

{% if signature %}
<div class="signature-block">
    <h3>Electronic Signature</h3>
    <div class="signature-name">{{ signature.signature_name }}</div>
    <div class="signature-details">
        <p><strong>Signed by:</strong> {{ agreement.customer_name }}</p>
        <p><strong>Date:</strong> {{ signature.signed_at }}</p>
        <p><strong>IP Address:</strong> {{ signature.signature_ip or 'Not recorded' }}</p>
    </div>
</div>
{% else %}
<div class="unsigned-notice no-print">
    <h3>This agreement requires your signature</h3>
    <p>Please review the terms above and sign to proceed with your project.</p>
    <a href="{{ url_for('customers.sign_agreement_route', agreement_id=agreement.id) }}" class="btn btn-primary">
        Sign Agreement
    </a>
</div>
{% endif %}

<div class="actions no-print" style="margin-top: 2rem;">
    <a href="{{ url_for('customers.agreements') }}" class="btn btn-secondary">Back to Agreements</a>
    <a href="{{ url_for('customers.project_detail', project_id=agreement.project_id) }}" class="btn btn-secondary">
        View Project
    </a>
</div>
{% endblock %}
